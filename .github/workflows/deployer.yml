name: Deployment

# on commit push, run job
on:
    push:
        branches:
            - master

jobs:

    permissions: write-all

    run:
        # worker runs on latest ubuntu
        runs-on: ubuntu-latest

        steps:
            # checkout to our repository so we have access to the source code
            - uses: actions/checkout@v3

            - id: auth
              uses: google-github-actions/auth@v0
              with:
                  credentials_json: ${{ secrets.GCP_SA_KEY }}

            # the actual deployment to google
            - id: deploy
              name: Cloud Functions Deploy
              uses: google-github-actions/deploy-cloud-functions@v0
              with:
                  name: atomi-wobi-stat
                  description: Wobi statistic # nullable
                  region: europe-central2
                  source_dir: /
                  # name of our function in our main.py file, defaults to the resource name suffix
                  entry_point: main
                  # runtime to use for the function
                  runtime: node16
                  # the function execution timeout
                  timeout: 60
                  # the maximum number of instances for the function.
                  max_instances: 1
                  # optional configs, see google-cloud-actions/deploy-cloud-functions for full reference
                  # list of key-value pairs to set as environment variables in the form KEY1=VALUE1,KEY2=VALUE2.
#       env_vars: # optional
